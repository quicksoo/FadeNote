# FadeNote 产品需求说明书（PRD V1）

> 角色设定

* **你（我）**：产品负责人 + 首席架构师，所有规则在此文档中定死
* **你（开发者）**：严格按本文档实现，不需要再做产品取舍

---

## 一、产品一句话定义（不可再改）

**FadeNote 是一款「会自动消失的桌面便签工具」，所有便签默认在 7 天后淡出并归档，帮助用户只关注当下重要的事情。**

关键词：

* 桌面级便签
* 自动消失（不是手动清理）
* 文件即数据（用户可直接看到、编辑）

---

## 二、目标用户与使用场景（定死）

### 2.1 目标用户

* 程序员 / 设计师 / 知识工作者
* 经常在桌面写临时信息，但讨厌长期堆积便签

### 2.2 核心使用场景

* 写一个「几天内要处理」的事情
* 写一个「临时灵感 / 备忘」
* 不希望自己去“删除”它

⚠️ **FadeNote 不是：**

* 长期知识管理工具
* Evernote / Obsidian 替代品

---

## 三、产品核心规则（这是产品的灵魂）

### 3.1 生命周期规则（最重要）

1. **每一条便签在创建时就注定会消失**
2. 默认生命周期：**7 天**
3. 到期后：

   * 不再出现在桌面
   * 不再参与活跃索引
   * 进入「归档区」

> ❌ 没有「永久便签」这个概念（V1）

---

### 3.2 用户能做的事情（V1 限定）

| 操作       | 是否支持     |
| -------- | -------- |
| 创建便签     | ✅        |
| 编辑内容     | ✅        |
| 移动位置     | ✅        |
| 关闭窗口     | ✅（不等于删除） |
| 手动删除     | ❌        |
| 延长生命周期   | ❌        |
| 设置不同过期时间 | ❌        |

> **产品必须“克制”，否则就不是 FadeNote**

---

## 四、交互模型（开发必须按这个来）

### 4.1 便签即窗口

* 每条便签 = 一个独立窗口
* 可拖动
* 关闭窗口 ≠ 删除数据

### 4.2 启动行为

* App 启动时：

  * 自动加载 **所有未过期便签**
  * 恢复上次的位置

---

## 五、数据层总体设计（架构定死）

### 5.1 设计原则

1. **文件即真相（File is Source of Truth）**
2. index.json 是索引，不是数据本体
3. 不依赖数据库
4. 用户可以直接用编辑器打开文件

---

## 六、目录结构（必须严格一致）

```
FadeNoteData/
├─ index.json              # 全局索引（唯一）
├─ notes/
│  ├─ 2026-01-15/
│  │  ├─ note-uuid-1.md
│  │  └─ note-uuid-2.md
│  ├─ 2026-01-16/
│  │  └─ note-uuid-3.md
│  └─ archive/
│     ├─ note-uuid-old.md
```

---

## 七、Note 文件格式（md 是数据本体）

### 7.1 note.md 示例

```md
---
id: note-uuid-1
createdAt: 2026-01-15T09:12:00Z
expiresAt: 2026-01-22T09:12:00Z
x: 320
y: 180
---

今天要把 FadeNote 的数据结构定死
```

### 7.2 说明

| 字段        | 含义    | 写入时机                 |
| --------- | ----- | -------------------- |
| id        | 唯一 ID | 创建时                  |
| createdAt | 创建时间  | 创建时                  |
| expiresAt | 过期时间  | 创建时（createdAt + 7 天） |
| x / y     | 窗口位置  | 拖动后                  |
| 正文        | 内容    | 编辑时                  |

---

## 八、index.json（索引而非真相）

### 8.1 index.json 职责

* 快速启动
* 判断哪些便签是「活跃的」
* 避免每次扫描全部文件

### 8.2 index.json 完整示例

```json
{
  "version": 1,
  "lastUpdatedAt": "2026-01-15T10:00:00Z",
  "notes": {
    "note-uuid-1": {
      "path": "notes/2026-01-15/note-uuid-1.md",
      "createdAt": "2026-01-15T09:12:00Z",
      "expiresAt": "2026-01-22T09:12:00Z",
      "updatedAt": "2026-01-15T09:30:00Z",
      "archived": false
    }
  }
}
```

### 8.3 字段写入规则（非常重要）

| 字段            | 何时写             |
| ------------- | --------------- |
| createdAt     | 创建 note 时       |
| expiresAt     | 创建 note 时       |
| updatedAt     | 内容变更 / 位置变更     |
| archived      | 过期归档时           |
| lastUpdatedAt | index.json 每次写入 |

---

## 九、7 天过期判断机制（定死）

**唯一判断依据：**

```text
now >= expiresAt
```

### 行为

* 启动时检查
* 若过期：

  * 从活跃 notes 中移除
  * note.md 移动到 archive/
  * index.json 标记 archived: true

> ❌ 不根据文件夹日期判断

---

## 十、应用启动流程（开发照着写）

1. 启动 App
2. 读取 index.json
3. 遍历 notes：

   * now < expiresAt → 创建窗口
   * now ≥ expiresAt → 执行归档
4. 渲染所有活跃便签

---

## 十一、你作为开发不需要再想的事情

* 要不要数据库 ❌
* 要不要永久便签 ❌
* 要不要复杂标签系统 ❌
* 要不要多生命周期 ❌

**你只需要实现。**

---

## 十二、V1 之后才允许考虑的事情（现在禁止）

* 生命周期自定义
* 搜索
* 标签
* 云同步

-------------------
# FadeNote 工程实现任务拆解清单（V1）

> 本清单是**工程执行清单**，不是讨论稿
> 你只需要按顺序完成，每一项都可以独立验收

---

## 阶段 0：工程初始化（一次性）

### T0-1 项目初始化

* [ ] 创建 Tauri 项目（Rust + Webview）
* [ ] 启用本地文件读写权限
* [ ] 确定数据根目录 `FadeNoteData/`

**验收标准**

* App 能启动
* 能在本地创建一个文件

---

## 阶段 1：核心数据模型（最重要）

> ⚠️ 本阶段**禁止写 UI**

### T1-1 定义数据结构（Rust Struct）

* [ ] `NoteMeta`

  * id
  * createdAt
  * expiresAt
  * x / y

* [ ] `IndexNoteEntry`

  * path
  * createdAt
  * expiresAt
  * updatedAt
  * archived

* [ ] `IndexFile`

  * version
  * lastUpdatedAt
  * notes: Map<id, IndexNoteEntry>

**验收标准**

* Struct 与 PRD 字段一一对应

---

### T1-2 index.json 读写模块

* [ ] 启动时读取 index.json
* [ ] index.json 不存在时自动创建
* [ ] 写入时整体覆盖（不做增量）

**验收标准**

* index.json 可被手动删除后自动恢复

---

### T1-3 Note 文件创建模块

* [ ] 生成 UUID
* [ ] 计算 expiresAt = createdAt + 7 天
* [ ] 创建日期目录 `notes/YYYY-MM-DD/`
* [ ] 写入 note.md（含 Front Matter）
* [ ] 写入 index.json 对应条目

**验收标准**

* 创建一个 note 后，磁盘上能看到 md 文件

---

### T1-4 Note 文件更新模块

* [ ] 更新正文内容
* [ ] 更新 x / y
* [ ] 同步更新 index.json 的 updatedAt

**验收标准**

* 手动编辑 md 后，App 能重新加载

---

## 阶段 2：生命周期与归档（核心差异点）

### T2-1 过期判断函数

* [ ] 实现 `isExpired(note) -> bool`
* [ ] 判断规则：now >= expiresAt

**验收标准**

* 修改系统时间可触发过期

---

### T2-2 归档执行逻辑

* [ ] 移动 note.md → `notes/archive/`
* [ ] index.json 标记 archived = true
* [ ] 不删除任何文件

**验收标准**

* 过期 note 不再被加载
* 文件仍可在 archive 中找到

---

## 阶段 3：应用启动流程

### T3-1 启动扫描流程

* [ ] 启动时读取 index.json
* [ ] 遍历所有 notes

  * 未过期 → 标记为活跃
  * 已过期 → 执行归档

**验收标准**

* 启动后只加载活跃 notes

---

### T3-2 活跃 Note 列表输出

* [ ] 返回活跃 note 的路径列表
* [ ] 为 UI 提供纯数据接口

**验收标准**

* UI 层无需接触文件系统

---

## 阶段 4：窗口 / UI 层（后做）

### T4-1 Note → Window 映射

* [ ] 一个 note = 一个窗口
* [ ] 使用 x / y 恢复位置

---

### T4-2 窗口事件回写

* [ ] 拖动窗口 → 更新 x / y
* [ ] 内容变更 → 更新 md + index.json

**验收标准**

* 重启 App，窗口位置不变

---

## 阶段 5：稳定性与容错（最低要求）

### T5-1 异常处理

* [ ] index.json 损坏 → 自动重建
* [ ] md 缺失 → 从 index 中移除

---

## 阶段 6：V1 完成定义（必须全部满足）

* [ ] 创建便签
* [ ] 编辑便签
* [ ] 自动 7 天过期
* [ ] 过期自动归档
* [ ] 重启状态恢复

> ✔️ 完成以上，即为 **FadeNote V1 Done**

---

## ⚠️ 明确禁止在 V1 中出现的内容

* 生命周期配置
* 永久便签
* 标签 / 搜索
* 云同步

